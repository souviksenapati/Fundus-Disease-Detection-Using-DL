<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Glaucoma Detection AI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f2f6fc;
            padding: 40px 15px;
        }

        .container {
            max-width: 800px;
            margin: auto;
        }

        .card-upload {
            background: #ffffff;
            border: none;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
            padding: 30px;
        }

        .title {
            font-size: 26px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
            color: #2e4057;
        }

        .btn-upload {
            width: 100%;
            background-color: #1d3557;
            border: none;
            padding: 12px;
            font-size: 16px;
            color: #fff;
            border-radius: 12px;
            transition: 0.3s;
        }

        .btn-upload:hover {
            background-color: #16324f;
        }

        .result-card {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            margin-top: 25px;
        }

        .result-card h5 {
            font-weight: 600;
            color: #1d3557;
        }

        .result-card p {
            font-size: 16px;
        }

        .result-tag {
            padding: 5px 12px;
            border-radius: 8px;
            display: inline-block;
            font-weight: bold;
            font-size: 15px;
        }

        .loader {
            text-align: center;
            margin-top: 20px;
        }

        .footer {
            margin-top: 50px;
            text-align: center;
            font-size: 14px;
            color: #888;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="card-upload">
        <div class="title">üëÅÔ∏è Glaucoma Detection System</div>
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="mb-3">
                <label for="fileInput" class="form-label">Upload a fundus image or video:</label>
                <input class="form-control" type="file" id="fileInput" name="file" accept="image/*,video/*" required>
            </div>
            <button type="submit" class="btn-upload">üîç Analyze</button>
        </form>

        <div class="loader d-none" id="loader">
            <div class="spinner-border text-primary mt-4" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Analyzing input... Please wait</p>
        </div>
    </div>

    <div class="result-card d-none" id="resultSection">
        <h5>‚úÖ Analysis Result</h5>
        <p><i class="fas fa-ruler"></i> <strong>CDR Value:</strong> <span id="cdrVal"></span></p>
        <p><i class="fas fa-diagnoses"></i> <strong>Diagnosis:</strong> <span id="diagnosis"></span></p>
        <p><i class="fas fa-percentage"></i> <strong>Risk Level:</strong> <span id="risk"></span>%</p>
        <div class="result-tag mt-3" id="tagLabel"></div>
    </div>

    <div class="alert alert-danger d-none mt-4" id="errorSection">
        <strong>Error:</strong> <span id="errorMsg"></span>
    </div>

    <div class="footer">
        Developed by AI Vision | Powered by YOLOv8 + Flask
    </div>
</div>

<!-- JS -->
<script>
    const form = document.getElementById("uploadForm");
    const loader = document.getElementById("loader");
    const resultSection = document.getElementById("resultSection");
    const errorSection = document.getElementById("errorSection");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        loader.classList.remove("d-none");
        resultSection.classList.add("d-none");
        errorSection.classList.add("d-none");

        const formData = new FormData(form);

        try {
            const response = await fetch("/predict", {
                method: "POST",
                body: formData
            });

            const data = await response.json();
            loader.classList.add("d-none");

            if (response.ok && data.cdr !== null) {
                document.getElementById("cdrVal").textContent = data.cdr;
                document.getElementById("diagnosis").textContent = data.diagnosis;
                document.getElementById("risk").textContent = data.risk ?? "N/A";

                // Set tag
                const tag = document.getElementById("tagLabel");
                tag.classList.remove("bg-success", "bg-warning", "bg-danger");

                if (data.risk === 0) {
                    tag.textContent = "üü¢ Healthy";
                    tag.classList.add("bg-success", "text-white");
                } else if (data.risk < 100) {
                    tag.textContent = "üü° Risky";
                    tag.classList.add("bg-warning", "text-dark");
                } else {
                    tag.textContent = "üî¥ Glaucoma Detected";
                    tag.classList.add("bg-danger", "text-white");
                }

                resultSection.classList.remove("d-none");
            } else {
                throw new Error(data.error || data.diagnosis || "Unknown error");
            }

        } catch (err) {
            loader.classList.add("d-none");
            document.getElementById("errorMsg").textContent = err.message;
            errorSection.classList.remove("d-none");
        }
    });
</script>
</body>
</html>
